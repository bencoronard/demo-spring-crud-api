services:
  app:
    image: gateway-scheduler:v1
    build:
      context: .
      dockerfile: ./Dockerfile
    ports:
      - 8080:8080
    depends_on:
      - db
    restart: always
    networks:
      - public
      - private
    environment:
      SERVER_PORT: 8080
      SERVER_API_KEY: loxbit888
      DATASOURCE_URI: jdbc:postgresql://db:5432/user
      DATASOURCE_USERNAME: loxbit
      DATASOURCE_PASSWORD: loxley
      GATEWAY_URI: http://gateway:8081
      GATEWAY_API_KEY: loxley888

  gateway:
    image: bencoronard/api-gateway:v1
    restart: always
    networks:
      - public
    environment:
      SERVER_PORT: 8081
      SERVER_API_KEY: loxley888

  db:
    image: postgres:16.4-alpine
    ports:
      - 5432:5432
    restart: always
    networks:
      - private
    volumes:
      - db_data:/var/lib/postgresql/data
      - ./src/main/resources/db/migration/schema-postgresql.sql:/docker-entrypoint-initdb.d/schema-postgresql.sql
    environment:
      POSTGRES_DB: user
      POSTGRES_USER: loxbit
      POSTGRES_PASSWORD: loxley

networks:
  public:
  private:

volumes:
  db_data:


  
